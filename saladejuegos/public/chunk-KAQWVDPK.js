import{b as N,d as R,h as j,o as L,p as Q}from"./chunk-A76EBF2T.js";import{j as D,p as U}from"./chunk-IPLXXL6T.js";import{a as f}from"./chunk-5DZY57WY.js";import{$a as T,Ca as M,Ga as y,K as w,Na as v,Pa as k,Q as m,Qa as O,Ra as P,Sa as B,Ta as a,Ua as s,Va as d,W as h,X as g,Ya as S,Za as x,_a as l,ab as E,bb as I,cb as u,db as C,eb as _,gb as F,hb as q,ib as z,mb as V,sa as r}from"./chunk-EIQFDW2Z.js";import{h as c}from"./chunk-FK42CRUA.js";var b=class o{supaBaseChat=m(f);constructor(){}getMessages(){return c(this,null,function*(){return yield this.supaBaseChat.supabaseFunctions.schema("public").from("messages").select("*").order("id",{ascending:!0})})}sendMessage(t,e,i){return c(this,null,function*(){return yield this.supaBaseChat.supabaseFunctions.schema("public").from("messages").insert([{context:t,username:e,inserted_at:i}]).then(({data:n,error:p})=>{p&&console.log(p.message)})})}onNewMessage(t){return this.supaBaseChat.supabaseFunctions.channel("messages_channel").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},e=>t(e.new)).subscribe()}static \u0275fac=function(e){return new(e||o)};static \u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"})};var A=["chatBox"],J=(o,t)=>({"chat-myUser":o,"chat-anotherUser":t});function Y(o,t){if(o&1&&(a(0,"div",5)(1,"p",12),d(2,"i",13),u(3),s(),a(4,"p",14),u(5),s(),a(6,"p",15),u(7),s()()),o&2){let e,i=t.$implicit,n=l(2);v("ngClass",V(4,J,i.username==((e=n.supabase.currentUser())==null?null:e.email),i.username!=((e=n.supabase.currentUser())==null?null:e.email))),r(3),_(" ",i.username.split("@",1)[0],": "),r(2),C(i.context),r(2),C(i.inserted_at)}}function Z(o,t){if(o&1){let e=S();a(0,"button",1),x("click",function(){h(e);let n=l();return g(n.openCloseChat())}),d(1,"i",2),s(),a(2,"div",3)(3,"div",4,0),P(5,Y,8,7,"div",5,O),s(),a(7,"div",6)(8,"p",7),u(9),d(10,"i",8),s(),a(11,"input",9),z("ngModelChange",function(n){h(e);let p=l();return q(p.newMessage,n)||(p.newMessage=n),g(n)}),s(),a(12,"button",10),x("click",function(){h(e);let n=l();return g(n.sendMessage())}),d(13,"i",11),s()()()}if(o&2){let e=l();r(5),B(e.messages),r(4),_("",e.newMessage.length,"/150"),r(2),F("ngModel",e.newMessage)}}var H=class o{messages=[];newMessage="";subscription;condition=!0;time;exactTime="";chatBox;supabase=m(f);supabaseChat=m(b);constructor(){}ngOnInit(){return c(this,null,function*(){let{data:t,error:e}=yield this.supabaseChat.getMessages();e?console.error("Error loading messages",e):(this.messages=t||[],setTimeout(()=>this.scrollToBottom(),0)),this.subscription=this.supabaseChat.onNewMessage(i=>{this.messages.push(i),setTimeout(()=>this.scrollToBottom(),100)})})}scrollToBottom(){this.chatBox&&(this.chatBox.nativeElement.scrollTop=this.chatBox.nativeElement.scrollHeight)}sendMessage(){return c(this,null,function*(){this.time=new Date,this.exactTime=this.time.getHours().toString()+":",this.time.getMinutes().toString().length<2&&(this.exactTime+="0"),this.exactTime+=this.time.getMinutes().toString();let t=this.supabase.currentUser();if(!t){console.log("Error");return}this.newMessage.trim()&&(yield this.supabaseChat.sendMessage(this.newMessage,t.email,this.exactTime),this.newMessage="")})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}openCloseChat(){let t=document.getElementById("chat");if(this.condition){t?.classList.add("open-chat"),this.condition=!1;return}t?.classList.remove("open-chat"),this.condition=!0}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=M({type:o,selectors:[["app-chat"]],viewQuery:function(e,i){if(e&1&&T(A,5),e&2){let n;E(n=I())&&(i.chatBox=n.first)}},decls:1,vars:1,consts:[["chatBox",""],[1,"floatBtn","pulse",3,"click"],[1,"fa-solid","fa-comments",2,"font-size","50px","color","bisque"],["id","chat",1,"chat-container"],[1,"chat-box"],[3,"ngClass"],[1,"input-and-button"],[2,"font-size","20px","position","relative","color","bisque","top","90%","left","4%","margin-bottom","-1px"],[1,"fa-regular","fa-keyboard",2,"margin-left","10px"],["type","text","maxlength","150","placeholder"," Escriba un mensaje...",1,"input-chat-game",3,"ngModelChange","ngModel"],[1,"btn-send",3,"click"],[1,"fa-solid","fa-paper-plane"],[2,"font-size","25px","color","crimson","margin-bottom","-5px"],[1,"fa-solid","fa-hat-cowboy"],[2,"line-height","15px"],[2,"font-size","15px","position","relative","left","85%","margin-bottom","-5px"]],template:function(e,i){if(e&1&&y(0,Z,14,2),e&2){let n;k(((n=i.supabase.currentUser())==null?null:n.email)!=null?0:-1)}},dependencies:[U,D,Q,N,R,L,j],styles:['@font-face{font-family:westernFont;src:url("./media/DakotaRegular-eZpj6-HFFEUJUJ.ttf")}@keyframes _ngcontent-%COMP%_pulse{25%{-webkit-transform:scale(1.05);-ms-transform:scale(1.05);transform:scale(1.05)}75%{-webkit-transform:scale(.95);-ms-transform:scale(.95);transform:scale(.95)}}@keyframes _ngcontent-%COMP%_slideInFromBelow{0%{transform:translateY(10%);opacity:0}to{transform:translate(0);opacity:1}}@keyframes _ngcontent-%COMP%_fadeInOpacity{0%{opacity:0}to{opacity:1}}.input-and-button[_ngcontent-%COMP%]{position:relative;top:4.5%;left:3%}.chat-myUser[_ngcontent-%COMP%]{position:relative;right:-45%;min-width:none;max-width:210px;border-radius:15%;background-color:bisque;color:#000;padding:10px;font-size:20px;margin-bottom:10px;border:3px solid black;overflow-x:hidden;animation:.4s ease-in 0s 1 _ngcontent-%COMP%_slideInFromBelow}.chat-anotherUser[_ngcontent-%COMP%]{position:relative;left:0%;min-width:none;max-width:210px;border-radius:15%;background-color:#deb887;border:3px solid black;color:#000;padding:10px;overflow-x:hidden;font-size:20px;margin-bottom:10px;animation:.4s ease-in 0s 1 _ngcontent-%COMP%_slideInFromBelow}h1[_ngcontent-%COMP%]{font-size:25px}.chat-box[_ngcontent-%COMP%]{position:relative;max-height:470px;top:3%;overflow:auto;padding:15px;border:1px solid bisque;border-radius:5%}.chat-box[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.btn-send[_ngcontent-%COMP%]{position:relative;width:45px;height:45px;border-radius:15%;background-color:#be0c0caf;color:bisque;border-color:bisque}.btn-send[_ngcontent-%COMP%]:hover{transition:1s;background-color:#000;border-color:bisque;color:#e73332}.input-chat-game[_ngcontent-%COMP%]{margin-right:30px;position:relative;left:3%;font-size:20px;width:300px;background-color:bisque;border-radius:2%;margin-bottom:25px;height:40px}.input-chat-game[_ngcontent-%COMP%]:focus{background-color:#000;border-color:bisque;color:bisque}i[_ngcontent-%COMP%]{font-size:20px}.chat-container[_ngcontent-%COMP%]{font-family:westernFont;position:absolute;width:450px;height:600px;border-radius:10%;top:55%;left:75%;background:#b814149a;box-shadow:0 4px 30px #0000001a;backdrop-filter:blur(14.5px);-webkit-backdrop-filter:blur(14.5px);border:2px solid black;padding:15px;transform:scale(.0000001);transition:transform .4s,top .4s;z-index:2}.open-chat[_ngcontent-%COMP%]{transform:scale(1);top:25%;z-index:5000}.floatBtn[_ngcontent-%COMP%]{background-color:transparent;position:fixed;top:87%;left:94%;width:90px;height:80px;border-radius:15%;border:transparent;box-shadow:5px 3px 15px #000}.floatBtn[_ngcontent-%COMP%]:hover{background-color:brown}.floatBtn[_ngcontent-%COMP%]   .pulse[_ngcontent-%COMP%]:hover{-webkit-animation-name:_ngcontent-%COMP%_pulse;animation-name:_ngcontent-%COMP%_pulse;-webkit-animation-duration:1.5s;animation-duration:1.5s;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-iteration-count:1;animation-iteration-count:infinite}']})};export{H as a};
